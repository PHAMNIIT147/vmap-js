var VMAP=function(){"use strict";class t{constructor(t){this.id=t.getAttribute("id"),this.allowMultipleAds=t.getAttribute("allowMultipleAds"),this.followRedirects=t.getAttribute("followRedirects"),this.vastAdData=null,this.adTagURI=null,this.customData=null;for(const e in t.childNodes){const s=t.childNodes[e];switch(s.localName){case"AdTagURI":this.adTagURI={templateType:s.getAttribute("templateType"),uri:(s.textContent||s.text||"").trim()};break;case"VASTAdData":for(this.vastAdData=s.firstChild;this.vastAdData&&1!==this.vastAdData.nodeType;)this.vastAdData=this.vastAdData.nextSibling;break;case"CustomAdData":this.customData=s}}}}function e(t,e){return[...t.childNodes].filter(t=>t.nodeName===e||e===`vmap:${t.nodeName}`||t.nodeName===`vmap:${e}`)}function s(t){const e={attributes:{},children:{},value:{}};return e.value=function(t){const e=t&&t.childNodes&&[...t.childNodes];if(!e)return{};const s=e.filter(t=>"#cdata-section"===t.nodeName);if(s&&s.length>0)try{return JSON.parse(s[0].data)}catch(t){}return e.reduce((t,e)=>{let s="";switch(e.nodeName){case"#text":s=e.textContent.trim();break;case"#cdata-section":s=e.data}return t+s},"")}(t),t.attributes&&[...t.attributes].forEach(t=>{t.nodeName&&void 0!==t.nodeValue&&null!==t.nodeValue&&(e.attributes[t.nodeName]=t.nodeValue)}),t.childNodes&&[...t.childNodes].filter(t=>"#"!==t.nodeName.substring(0,1)).forEach(t=>{e.children[t.nodeName]=s(t)}),e}class a{constructor(a){this.timeOffset=a.getAttribute("timeOffset"),this.breakType=a.getAttribute("breakType"),this.breakId=a.getAttribute("breakId"),this.repeatAfter=a.getAttribute("repeatAfter"),this.adSource=null,this.trackingEvents=[],this.extensions=[];for(const i in a.childNodes){const n=a.childNodes[i];switch(n.localName){case"AdSource":this.adSource=new t(n);break;case"TrackingEvents":for(const t in n.childNodes){const e=n.childNodes[t];"Tracking"===e.localName&&this.trackingEvents.push({event:e.getAttribute("event"),uri:(e.textContent||e.text||"").trim()})}break;case"Extensions":this.extensions=e(n,"Extension").map(t=>s(t))}}}track(t,e){for(const s in this.trackingEvents){const a=this.trackingEvents[s];if(a.event===t){let{uri:t}=a;"error"===a.event&&(t=t.replace("[ERRORCODE]",e)),this.tracker(t)}}}tracker(t){if("undefined"!=typeof window&&null!==window){(new Image).src=t}}}return class{constructor(t){if(null===(null!==t?t.documentElement:void 0)||"VMAP"!==t.documentElement.localName)throw new Error("Not a VMAP document");this.version=t.documentElement.getAttribute("version"),this.adBreaks=[],this.extensions=[];for(const i in t.documentElement.childNodes){const n=t.documentElement.childNodes[i];switch(n.localName){case"AdBreak":this.adBreaks.push(new a(n));break;case"Extensions":this.extensions=e(n,"Extension").map(t=>s(t))}}}}}();
