"use strict";var classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)},VMAPAdSource=function e(t){for(var a in classCallCheck(this,e),this.id=t.getAttribute("id"),this.allowMultipleAds=t.getAttribute("allowMultipleAds"),this.followRedirects=t.getAttribute("followRedirects"),this.vastAdData=null,this.adTagURI=null,this.customData=null,t.childNodes){var n=t.childNodes[a];switch(n.localName){case"AdTagURI":this.adTagURI={templateType:n.getAttribute("templateType"),uri:(n.textContent||n.text||"").trim()};break;case"VASTAdData":for(this.vastAdData=n.firstChild;this.vastAdData&&1!==this.vastAdData.nodeType;)this.vastAdData=this.vastAdData.nextSibling;break;case"CustomAdData":this.customData=n}}};function childrenByName(e,t){return[].concat(toConsumableArray(e.childNodes)).filter(function(e){return e.nodeName===t||t==="vmap:"+e.nodeName||e.nodeName==="vmap:"+t})}function parseNodeText(e){return e&&e.childNodes&&[].concat(toConsumableArray(e.childNodes)).filter(function(e){return"#text"===e.nodeName}).reduce(function(e,t){return e+t.textContent.trim()},"")}function parseXMLNode(e){var t={attributes:{},children:{},value:null};return t.value=parseNodeText(e)||null,e.attributes&&[].concat(toConsumableArray(e.attributes)).forEach(function(e){e.nodeName&&void 0!==e.nodeValue&&null!==e.nodeValue&&(t.attributes[e.nodeName]=e.nodeValue)}),[].concat(toConsumableArray(e.childNodes)).filter(function(e){return"#text"!==e.nodeName&&"#comment"!==e.nodeName}).forEach(function(e){t.children[e.nodeName]=parseXMLNode(e)}),t}var VMAPAdBreak=function(){function e(t){for(var a in classCallCheck(this,e),this.timeOffset=t.getAttribute("timeOffset"),this.breakType=t.getAttribute("breakType"),this.breakId=t.getAttribute("breakId"),this.repeatAfter=t.getAttribute("repeatAfter"),this.adSource=null,this.trackingEvents=[],this.extensions=[],t.childNodes){var n=t.childNodes[a];switch(n.localName){case"AdSource":this.adSource=new VMAPAdSource(n);break;case"TrackingEvents":for(var r in n.childNodes){var i=n.childNodes[r];"Tracking"===i.localName&&this.trackingEvents.push({event:i.getAttribute("event"),uri:(i.textContent||i.text||"").trim()})}break;case"Extensions":this.extensions=childrenByName(n,"Extension").map(function(e){return parseXMLNode(e)})}}}return createClass(e,[{key:"track",value:function(e,t){for(var a in this.trackingEvents){var n=this.trackingEvents[a];if(n.event===e){var r=n.uri;"error"===n.event&&(r=r.replace("[ERRORCODE]",t)),this.tracker(r)}}}},{key:"tracker",value:function(e){"undefined"!=typeof window&&null!==window&&((new Image).src=e)}}]),e}(),VMAP=function e(t){if(classCallCheck(this,e),null==(null!=t?t.documentElement:void 0)||"VMAP"!==t.documentElement.localName)throw new Error("Not a VMAP document");for(var a in this.version=t.documentElement.getAttribute("version"),this.adBreaks=[],this.extensions=[],t.documentElement.childNodes){var n=t.documentElement.childNodes[a];switch(n.localName){case"AdBreak":this.adBreaks.push(new VMAPAdBreak(n));break;case"Extensions":this.extensions=childrenByName(n,"Extension").map(function(e){return parseXMLNode(e)})}}};module.exports=VMAP;
